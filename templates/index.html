<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dishtrict Map</title>
    <link rel="stylesheet" href="/static/css/style.css">
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@200;300;400;500;700&family=Inter:wght@200;300;400;500;600;700&display=swap" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
</head>
<body>
    <header>
        <h1>Dishtrict Map</h1>
    </header>
    <main>
        <div class="main-flex-row map-flex-row">
            <form method="post" id="catForm" class="side-radio-form">
                {% for cat in categories %}
                    <input type="radio" name="category" value="{{ cat }}" id="cat_{{ loop.index }}" {% if cat == selected_cat %}checked{% endif %} onchange="document.getElementById('catForm').submit();">
                    <label for="cat_{{ loop.index }}">{{ cat }}</label>
                {% endfor %}
            </form>
            <div class="map-container">
                {{ map_html|safe }}
            </div>
            <div class="colorbar-legend">
                <span class="colorbar-value colorbar-value-top">{{ vmax if selected_cat else 0 }}</span>
                <div class="colorbar-gradient {% if not selected_cat %}colorbar-gradient-empty{% endif %}"></div>
                <span class="colorbar-value colorbar-value-bottom">{{ vmin if selected_cat else 0 }}</span>
                <div class="colorbar-title">{{ selected_cat if selected_cat else 'ì„ íƒì•ˆë¨' }} ê°€ê²©</div>
            </div>
        </div>

        <div class="price-recommendation-section">
            <h2 class="section-title">ğŸ½ï¸ ìŒì‹ ê°€ê²© ì¶”ì²œ ì‹œìŠ¤í…œ</h2>
            <p class="section-description">ì§€ì—­, ìŒì‹ íƒ€ì…, ì£¼ì¬ë£Œ, ë§µê¸°ë¥¼ ì„ íƒí•˜ì—¬ ìµœì ì˜ ê°€ê²©ì„ ì¶”ì²œë°›ìœ¼ì„¸ìš”</p>
            
            <div class="recommendation-container">
                <div class="input-group">
                    <div class="dropdown-selector">
                        <button class="dropdown-btn" type="button" onclick="toggleDropdown('region')">
                            <span class="selected-text">ì§€ì—­ ì„ íƒ</span>
                            <i class="fas fa-chevron-down"></i>
                        </button>
                        <div class="dropdown-content" id="region-dropdown">
                            <div class="option" data-value="ì„œìš¸">ì„œìš¸</div>
                            <div class="option" data-value="ë¶€ì‚°">ë¶€ì‚°</div>
                            <div class="option" data-value="ëŒ€êµ¬">ëŒ€êµ¬</div>
                            <div class="option" data-value="ì¸ì²œ">ì¸ì²œ</div>
                            <div class="option" data-value="ê´‘ì£¼">ê´‘ì£¼</div>
                            <div class="option" data-value="ëŒ€ì „">ëŒ€ì „</div>
                            <div class="option" data-value="ìš¸ì‚°">ìš¸ì‚°</div>
                            <div class="option" data-value="ì„¸ì¢…">ì„¸ì¢…</div>
                        </div>
                    </div>

                    <div class="dropdown-selector">
                        <button class="dropdown-btn" type="button" onclick="toggleDropdown('foodType')">
                            <span class="selected-text">ìŒì‹ íƒ€ì…</span>
                            <i class="fas fa-chevron-down"></i>
                        </button>
                        <div class="dropdown-content" id="foodType-dropdown">
                            <div class="option" data-value="í•œì‹">í•œì‹</div>
                            <div class="option" data-value="ì¤‘ì‹">ì¤‘ì‹</div>
                            <div class="option" data-value="ì¼ì‹">ì¼ì‹</div>
                            <div class="option" data-value="ì–‘ì‹">ì–‘ì‹</div>
                            <div class="option" data-value="ë¶„ì‹">ë¶„ì‹</div>
                            <div class="option" data-value="ì¹´í˜">ì¹´í˜</div>
                        </div>
                    </div>

                    <div class="dropdown-selector">
                        <button class="dropdown-btn" type="button" onclick="toggleDropdown('ingredient')">
                            <span class="selected-text">ì£¼ì¬ë£Œ</span>
                            <i class="fas fa-chevron-down"></i>
                        </button>
                        <div class="dropdown-content" id="ingredient-dropdown">
                            <div class="option" data-value="ë¼ì§€ê³ ê¸°">ë¼ì§€ê³ ê¸°</div>
                            <div class="option" data-value="ì†Œê³ ê¸°">ì†Œê³ ê¸°</div>
                            <div class="option" data-value="ë‹­ê³ ê¸°">ë‹­ê³ ê¸°</div>
                            <div class="option" data-value="í•´ì‚°ë¬¼">í•´ì‚°ë¬¼</div>
                            <div class="option" data-value="ì±„ì†Œ">ì±„ì†Œ</div>
                            <div class="option" data-value="ë©´ë¥˜">ë©´ë¥˜</div>
                            <div class="option" data-value="ë°¥ë¥˜">ë°¥ë¥˜</div>
                        </div>
                    </div>

                    <div class="dropdown-selector">
                        <button class="dropdown-btn" type="button" onclick="toggleDropdown('spiciness')">
                            <span class="selected-text">ë§µê¸°</span>
                            <i class="fas fa-chevron-down"></i>
                        </button>
                        <div class="dropdown-content" id="spiciness-dropdown">
                            <div class="option" data-value="ìˆœí•œë§›">ìˆœí•œë§›</div>
                            <div class="option" data-value="ë³´í†µë§›">ë³´í†µë§›</div>
                            <div class="option" data-value="ë§¤ìš´ë§›">ë§¤ìš´ë§›</div>
                            <div class="option" data-value="ë§¤ìš°ë§¤ìš´ë§›">ë§¤ìš°ë§¤ìš´ë§›</div>
                        </div>
                    </div>
                </div>

                <button class="recommend-btn" onclick="getPriceRecommendation()">
                    <i class="fas fa-calculator"></i>
                    ê°€ê²© ì¶”ì²œë°›ê¸°
                </button>

                <div class="result-container" id="result-container" style="display: none;">
                    <div class="result-card">
                        <h3>ì¶”ì²œ ê°€ê²©</h3>
                        <div class="price-display" id="price-display">
                            <span class="price-amount" id="price-amount">0</span>
                            <span class="price-unit">ì›</span>
                        </div>
                        <div class="price-explanation" id="price-explanation">
                            ì„ íƒí•˜ì‹  ì¡°ê±´ì„ ë°”íƒ•ìœ¼ë¡œ ì¶”ì²œëœ ê°€ê²©ì…ë‹ˆë‹¤.
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <script>
        // ë“œë¡­ë‹¤ìš´ í† ê¸€ í•¨ìˆ˜
        function toggleDropdown(dropdownId) {
            const dropdown = document.getElementById(dropdownId + '-dropdown');
            const btn = document.querySelector(`[onclick="toggleDropdown('${dropdownId}')"]`);
            const allDropdowns = document.querySelectorAll('.dropdown-content');
            const allBtns = document.querySelectorAll('.dropdown-btn');
            
            // ë‹¤ë¥¸ ë“œë¡­ë‹¤ìš´ë“¤ ë‹«ê¸°
            allDropdowns.forEach(dd => {
                if (dd !== dropdown) {
                    dd.classList.remove('show');
                }
            });
            
            // ë‹¤ë¥¸ ë²„íŠ¼ë“¤ì˜ active ìƒíƒœ ì œê±°
            allBtns.forEach(b => {
                if (b !== btn) {
                    b.classList.remove('active');
                }
            });
            
            // í˜„ì¬ ë“œë¡­ë‹¤ìš´ í† ê¸€
            dropdown.classList.toggle('show');
            btn.classList.toggle('active');
        }

        // ì˜µì…˜ ì„ íƒ í•¨ìˆ˜
        function selectOption(dropdownId, value, text) {
            const btn = document.querySelector(`[onclick="toggleDropdown('${dropdownId}')"]`);
            const selectedText = btn.querySelector('.selected-text');
            selectedText.textContent = text;
            selectedText.setAttribute('data-value', value);
            
            // ë“œë¡­ë‹¤ìš´ ë‹«ê¸°
            document.getElementById(dropdownId + '-dropdown').classList.remove('show');
            btn.classList.remove('active');
        }

        // ê°€ê²© ì¶”ì²œ í•¨ìˆ˜
        function getPriceRecommendation() {
            const region = document.querySelector('[onclick="toggleDropdown(\'region\')"] .selected-text').getAttribute('data-value');
            const foodType = document.querySelector('[onclick="toggleDropdown(\'foodType\')"] .selected-text').getAttribute('data-value');
            const ingredient = document.querySelector('[onclick="toggleDropdown(\'ingredient\')"] .selected-text').getAttribute('data-value');
            const spiciness = document.querySelector('[onclick="toggleDropdown(\'spiciness\')"] .selected-text').getAttribute('data-value');

            // ëª¨ë“  í•­ëª©ì´ ì„ íƒë˜ì—ˆëŠ”ì§€ í™•ì¸
            if (!region || !foodType || !ingredient || !spiciness) {
                alert('ëª¨ë“  í•­ëª©ì„ ì„ íƒí•´ì£¼ì„¸ìš”.');
                return;
            }

            // ë¡œë”© í‘œì‹œ
            const resultContainer = document.getElementById('result-container');
            const priceAmount = document.getElementById('price-amount');
            const priceExplanation = document.getElementById('price-explanation');
            
            resultContainer.style.display = 'block';
            priceAmount.textContent = 'ê³„ì‚° ì¤‘...';
            priceExplanation.textContent = 'AIê°€ ìµœì ì˜ ê°€ê²©ì„ ë¶„ì„í•˜ê³  ìˆìŠµë‹ˆë‹¤.';

            // ë°±ì—”ë“œ API í˜¸ì¶œ (ì‹¤ì œ êµ¬í˜„ ì‹œ)
            setTimeout(() => {
                // ì„ì‹œ ê²°ê³¼ (ì‹¤ì œë¡œëŠ” ë°±ì—”ë“œì—ì„œ ë°›ì•„ì˜¬ ë°ì´í„°)
                const mockPrice = Math.floor(Math.random() * 5000) + 8000; // 8000~13000ì›
                priceAmount.textContent = mockPrice.toLocaleString();
                priceExplanation.textContent = `${region} ì§€ì—­ì˜ ${foodType} ${ingredient} ${spiciness} ë©”ë‰´ì— ëŒ€í•œ ì¶”ì²œ ê°€ê²©ì…ë‹ˆë‹¤.`;
            }, 1500);
        }

        // ë“œë¡­ë‹¤ìš´ ì™¸ë¶€ í´ë¦­ ì‹œ ë‹«ê¸°
        window.onclick = function(event) {
            if (!event.target.matches('.dropdown-btn') && !event.target.matches('.dropdown-btn *')) {
                const dropdowns = document.querySelectorAll('.dropdown-content');
                const btns = document.querySelectorAll('.dropdown-btn');
                
                dropdowns.forEach(dropdown => {
                    if (dropdown.classList.contains('show')) {
                        dropdown.classList.remove('show');
                    }
                });
                
                btns.forEach(btn => {
                    if (btn.classList.contains('active')) {
                        btn.classList.remove('active');
                    }
                });
            }
        }

        // ì˜µì…˜ í´ë¦­ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ
        document.addEventListener('DOMContentLoaded', function() {
            const options = document.querySelectorAll('.option');
            options.forEach(option => {
                option.addEventListener('click', function() {
                    const dropdownId = this.parentElement.id.replace('-dropdown', '');
                    const value = this.getAttribute('data-value');
                    const text = this.textContent;
                    selectOption(dropdownId, value, text);
                });
            });
        });
    </script>
</body>
</html> 